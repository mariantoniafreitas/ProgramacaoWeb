<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<div th:replace="~{controle :: import}"></div>
	<title>CRUD Pedido</title>
	<link rel="stylesheet" th:href="@{/css/CRUD_page.css}">
	<link rel="stylesheet" th:href="@{/css/toolbar-dropdown.css}">
</head>

<body>
	<!-- Header -->
	<div th:replace="~{controle :: header}"></div>

	<div class="row mx-0">

		<main class="col-12 px-md-4">
			<!-- ADD -->
			<div th:if="${pedido_add != null}">
				<h1>Registrar um novo pedido</h1>
				
				<form action="#" th:action="@{/pedido/CRUD/add}" th:object="${pedido_add}" method="post">
					<fieldset>
						<div th:if="${#lists.isEmpty(cliente_lista)}">
							<span>Nenhum cliente disponível no momento.</span>
						</div>
						<div th:unless="${#lists.isEmpty(cliente_lista)}">
							<legend>Escolha o cliente do Pedido</legend>
							
							<div th:each="clienteAtual : ${cliente_lista}" class="form-check">
							  <input class="form-check-input" type="radio" name="clienteEscolhido" th:value="${clienteAtual.id}" required>
							  <label class="form-check-label" for="clienteEscolhido">
							    <span>Nome: <i th:text="${clienteAtual.nome}"></i></span>
							    <span>CPF:  <i th:text="${clienteAtual.cpf}"></i></span>
							  </label>
							</div>
						</div>
						
						<button type="submit" class="btn my-3 btn-primary">Registrar</button>
					</fieldset>
				</form>
				<div th:if="${respostaAdd != null}">
					<span th:text="${respostaAdd}"></span>
				</div>
			</div>
			
		
			<!-- LIST -->
			<div th:if="${pedido_lista != null}">
				<h2>Buscar Pedido</h2>
				
				<nav class="navbar navbar-light bg-light">
				  <form class="form-inline d-flex ps-2" th:action="@{/pedido/CRUD/buscaPedido}" method="post">
				    <input class="form-control mr-sm-2" type="text" name="cpf" id="cpf" required placeholder="CPF do Cliente..." aria-label="Search">
				    <button class="btn btn-outline-success ms-3 my-2 my-sm-0" type="submit">Buscar</button>
				  </form>
				</nav>
				
				<h1 class="mt-4">Lista de pedidos</h1>
				
				<table class="table">
				  <thead class="thead-dark">
				    <tr>
				      <th scope="col">Id</th>
				      <th scope="col">Data Hora</th>
				      <th scope="col">Total do Pedido</th>
				      <th scope="col">Quantidade de Discos</th>
				      <th scope="col">Está concluido</th>
				      <th scope="col"></th>
				    </tr>
				  </thead>
				  <tbody>
				    <tr th:each="pedido : ${pedido_lista}" th:if="${pedido.cliente != null}">
				      <td th:text="${pedido.id}"></td>
				      <td th:text="${pedido.dataHora}"></td>
				      <td th:text="${pedido.totalPedido}"></td>
				      <td th:text="${pedido.discos.size()}"></td>
				      <td th:text="${pedido.concluido}"></td>
				      <td class="btn-actions">
						  <button th:if="${pedido.concluido}==false" type="button" class="btn btn-warning">
								<a th:href="@{/pedido/CRUD/editar(id=${pedido.id})}">Editar</a>
							</button>
							<button type="button" class="btn btn-danger">
								<a th:href="@{/pedido/CRUD/deletar(id=${pedido.id})}">Excluir</a>
							</button>
							<button th:if="${pedido.concluido}==false" type="button" class="btn btn-success">
								<a th:href="@{/pedido/CRUD/finalizar(id=${pedido.id})}">Finalizar</a>
							</button>
					  </td>
				    </tr>
				    
				    <tr th:if="${pedido_lista.size == 0}">
						<td></td>
						<td></td>
						<td>Nenhum pedido foi confirmado</td>
						<td></td>
						<td></td>
					</tr>
				  </tbody>
				</table>
			</div>


			<!-- EDIT -->
			<div th:if="${pedido_edit != null &&!pedido_edit.concluido}">
				<h1>Atualizar pedido</h1>
				
				<form action="@{/pedido/CRUD/atualizar}" th:action="@{/pedido/CRUD/atualizar}" th:object="${pedido_edit}" method="post">
					<fieldset>
						<legend>Escolha o cliente do Pedido</legend>
						
						<div th:each="clienteAtual:${cliente_lista}" class="form-check">
							<input class="form-check-input" type="radio" name="clienteId" th:value="${clienteAtual.id}" required>
							<label class="form-check-label" for="clienteEscolhido">
								<span>Nome: <i th:text="${clienteAtual.nome}"></i></span>
								<span>CPF:  <i th:text="${clienteAtual.cpf}"></i></span>
							</label>
						</div>
						<input type="hidden" name="pedidoId" id="pedidoId" th:value="*{id}" />

						<div class="form-group mb-2">
					    	<label for="dataHora">Data do Pedido</label>
					    	<input type="datetime-local" class="form-control" name="dataHora" id="dataHora" th:value="*{dataHora}" required>
					  	</div>
					  	
					  	<div class="form-group mb-2">
					    	<label for="frete">Frete</label>
					    	<input type="text" class="form-control" name="frete" id="frete" placeholder="Ex.: 0,0" th:value="*{frete}" required>
					  	</div>
					  	
					  	<div class="form-group mb-2">
					    	<label for="totalPedido">Total do Pedido</label>
					    	<input type="text" class="form-control" name="totalPedido" id="totalPedido" placeholder="Ex.: 0,0" th:value="*{totalPedido}" required>
					  	</div>
						
						<button type="submit" class="btn my-3 btn-primary">Atualizar</button>
					</fieldset>
				</form>
				
				<h2>Lista de Discos do Pedido</h2>
				
				<table class="table">
				  <thead class="thead-dark">
				    <tr>
				      <th scope="col">Id</th>
				      <th scope="col">Valor</th>
				      <th scope="col">Título</th>
				      <th scope="col">Interprete</th>
				      <th scope="col">Gênero</th>
				      <th scope="col">Gravadora</th>
				      <th scope="col">Tempo de Duração</th>
				      <th scope="col">Total de Músicas</th>
				      <th scope="col"></th>
				    </tr>
				  </thead>
				  <tbody>
				    <tr th:each="disco : ${disco_lista}" th:if="${disco.titulo != null}">
				      <td th:text="${disco.id}"></td>
				      <td th:text="${disco.valor}"></td>
				      <td th:text="${disco.titulo}"></td>
				      <td th:text="${disco.interprete}"></td>
				      <td th:text="${disco.genero}"></td>
				      <td th:text="${disco.gravadora}"></td>
				      <td th:text="${disco.tempoDuracao}"></td>
				      <td th:text="${disco.totalMusicas}"></td>
				      <td class="btn-actions">

							<button type="button" class="btn btn-danger">
								<a th:href="@{/pedido/CRUD/removeDisco(discoId=${disco.id},pedidoId=${pedido_edit.id})}
">Remover</a>
							</button>
					  </td>
				    </tr>
				    
				    <tr th:if="${disco_lista.size == 0}">
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td>Nenhum disco foi registrado</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
				  </tbody>
				</table>
				
				<h3>Adicionar disco</h3>
				
			<nav class="navbar navbar-light bg-light">
                    <form class="form-inline d-flex ps-2" th:action="@{/pedido/CRUD/addDisco}" th:object="${pedido_edit}" method="post">
<input type="hidden" name="pedidoId" id="pedidoId" th:value="*{id}" />

                        <input class="form-control mr-sm-2" type="text" name="titulo" id="titulo" required placeholder="Título do disco..." aria-label="Search">
                        <button class="btn btn-outline-success ms-3 my-2 my-sm-0" type="submit">Adicionar</button>
                    </form>
                </nav>
			</div>
		</main>
	</div>
</body>

</html>